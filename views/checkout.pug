extends layout

block content
    script.
        var RSD__SessionID = '';
        $.ajax(
            {
                headers: {'Access-Control-Allow-Origin': '*'},
                url: "/api/v1/checkout",
                type: 'GET',
                accepts: 'json',
                success: function(result){
                    RSD__SessionID = result.session.id[0];
                }
            }
        );
        localStorage.setItem('valorCompra', 1234.56);

    div(style='width: 100%; text-align: center; ')
        label
            b Dados para Contato
        div(style='display: inline-block; width: 100%; text-align: center; border: 0px; padding-bottom: 2px; margin: 2px;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b Nome
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b Celular
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b E-Mail
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b CEP
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')

    div(style='width: 100%; text-align: center; ')
        label
            b Dados para Entrega
        div(style='display: inline-block; width: 100%; text-align: center; border: 0px; padding-bottom: 2px; margin: 2px;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b Rua
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b NÃºmero
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b Bairro
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b Cidade
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b Estado
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')
    div(style='width: 100%; text-align: center; ')
        label
            b Dados para Pagamento
        div(style='display: inline-block; width: 100%; text-align: center; border: 0px; padding-bottom: 2px; margin: 2px;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b Forma
                br
                input(type='text', style='width: 96%; height: 32px; border: 1px solid gainsboro;')
            div(style='display: inline-block; width: 98%; max-width: 330px; text-align: left; border: 1px solid gainsboro; padding: 8px; margin: 2px;')
                label()
                    b Valor
                br
                input(type='text', id='textValor', readonly, style='width: 96%; height: 32px; border: 1px solid gainsboro;')
    br
    button(onclick='onCheckOut();' style="color: white; font-size: 16px; width: 98%; height: 42px; background: green; border: 0px") Finalizar
    script(src="https://stc.sandbox.pagseguro.uol.com.br/pagseguro/api/v2/checkout/pagseguro.directpayment.js", async)
    script.
        (function() {
            $('#textValor').val(localStorage.getItem('valorCompra'));
        })();

        function onCheckOut(){
            // javascript:window.location="/checkout-sucesso"
            PagSeguroDirectPayment.setSessionId(RSD__SessionID);

            PagSeguroDirectPayment.onSenderHashReady(
                function(response){
                    if(response.status == 'error') {
                        console.log(response.message);
                        return false;
                    }
                var hash = response.senderHash;
                console.log(hash);
                }
            );

            PagSeguroDirectPayment.getPaymentMethods(
                {
                    amount: localStorage.getItem('valorCompra'),
                    success: function(response) {
                        //meios de pagamento disponÃ­veis
                        console.log(response);
                    },
                    error: function(response) {
                        //tratamento do erro
                        console.log('Deu erro... '  + response);
                    },
                    complete: function(response) {
                        //tratamento comum para todas chamadas
                    }
                }
            );

            var boleto = 'paymentMode=default';
            boleto = boleto + '&paymentMethod=boleto';
            boleto = boleto + '&receiverEmail=suporte@lojamodelo.com.br';
            boleto = boleto + '&currency=BRL';
            boleto = boleto + '&extraAmount=1.00';
            boleto = boleto + '&itemId1=0001';
            boleto = boleto + '&itemDescription1=Notebook Prata';
            boleto = boleto + '&itemAmount1=24300.00';
            boleto = boleto + '&itemQuantity1=1';
            boleto = boleto + '&notificationURL=https://sualoja.com.br/notifica.html';
            boleto = boleto + '&reference=REF1234';
            boleto = boleto + '&senderName=Jose Comprador';
            boleto = boleto + '&senderCPF=22111944785';
            boleto = boleto + '&senderAreaCode=11';
            boleto = boleto + '&senderPhone=56273440';
            boleto = boleto + '&senderEmail=comprador@uol.com.br';
            boleto = boleto + '&senderHash=abc123';
            boleto = boleto + '&shippingAddressStreet=Av. Brig. Faria Lima';
            boleto = boleto + '&shippingAddressNumber=1384';
            boleto = boleto + '&shippingAddressComplement=5o andar';
            boleto = boleto + '&shippingAddressDistrict=Jardim Paulistano';
            boleto = boleto + '&shippingAddressPostalCode=01452002';
            boleto = boleto + '&shippingAddressCity=Sao Paulo';
            boleto = boleto + '&shippingAddressState=SP';
            boleto = boleto + '&shippingAddressCountry=BRA';
            boleto = boleto + '&shippingType=1';
            boleto = boleto + '&shippingCost=1.00';
            
            $.ajax(
                {
                    headers: {'Access-Control-Allow-Origin': '*'},
                    url: "/api/v1/checkout?senderHash=" + PagSeguroDirectPayment.getSenderHash().replace('"','').replace('"',''),
                    type: 'POST',
                    accepts: 'json',
                    success: function(result){
                        console.log('---> ' + result);
                    }
                }
            );
        }